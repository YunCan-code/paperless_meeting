# Android PDF 阅读器设计方案 v2.0 (现状与规划)

本文档基于现有代码实现 (`ReaderScreen.kt`, `MainScreen.kt`) 及“无纸化会议”需求，对阅读器功能进行盘点，并结合主流阅读器（如微信读书、Acrobat Reader）的特性提出演进规划。

## 1. 现状盘点 (Current Status)

目前 **阶段一 (Phase 1)** 核心阅读体验已完成，具备以下功能：

*   **[已实现] 沉浸式阅读 (Immersive UI)**: 默认全屏，点击屏幕中央唤起/隐藏顶部和底部工具栏。系统状态栏与导航栏自动联动隐藏。
*   **[已实现] 基础翻页控制**:
    *   支持横向滑动 (Swipe Horizontal)。
    *   支持单页吸附 (Snap to Page)，特别适配 PPT 场景。
    *   底部进度条 (Slider) 快速跳转。
    *   页面计数器 (Page Counter)。
*   **[已实现] 夜间模式 (Night Mode)**: 底部工具栏一键切换反色模式。
*   **[已实现] 屏幕空间优化**: 进入阅读器自动收起左侧应用导航栏 (Navigation Rail)。
*   **[已实现] 目录大纲 (Table of Contents)**: 侧边抽屉显示章节结构，支持点击跳转。

---

## 2. 缺失核心功能 (Missing Core Features)

这些是 v1.0 文档中规划但 **尚未实现** 的高优先级功能。

### A. 缩略图导航 (Thumbnail Grid)
*   **现状**: 暂无。
*   **设计**:
    *   **入口**: 底部工具栏右侧增加“四方格”图标。
    *   **交互**: 点击后底部弹起半屏面板 (Modal Bottom Sheet)。
    *   **内容**: 显示所有页面的网格预览图，当前页高亮。方便用户在长文档（如标书）中快速视觉定位。

### C. 会议同屏 (Screen Sync) —— 会议系统灵魂
*   **现状**: 完全未实现。
*   **设计**:
    *   **入口**: 顶部工具栏右侧 “同步” 开关。
    *   **逻辑**:
        *   **主讲人**: 翻页时通过 WebSocket 发送 `{ page: 5, zoom: 1.0 }`。
        *   **参会人**: 开启同步后，接收消息并自动 `jumpTo(page)`。
        *   **冲突处理**: 参会人手动翻页时，暂时解除同步（显示“返回主讲人视角”悬浮球）。

### D. 手写批注 (Ink Annotation)
*   **现状**: 代码开启了 `enableAnnotationRendering(true)` 用于显示 **已有** 批注，但无法 **新增** 批注。
*   **设计**:
    *   **技术方案**: 采用“蒙层法”。在 `AndroidView` (PDF) 之上覆盖透明 `Canvas` 或 `Compose Canvas`。
    *   **工具箱**: 侧边悬浮工具栏（笔、高亮、橡皮）。
    *   **数据流**: 绘制轨迹 -> 保存为坐标数组 -> 翻页时清空画布并重绘新页数据。

---

## 3. 现代化功能增强建议 (Modern Enhancements)

参考主流阅读软件，建议在后续版本加入以下功能以提升专业度：

### A. 全文搜索 (Full-Text Search)
*   **价值**: 快速定位会议关键词（如“预算”、“决议”）。
*   **实现**: `AndroidPdfViewer` 并没有直接提供高效的搜索 UI，需要利用 PDF 库的文本提取能力，在后台线程搜索关键词，并高亮显示结果（可以复用批注的高亮逻辑）。

### B. 书签系统 (Bookmarks)
*   **价值**: 标记重要页面，方便回头查阅。
*   **交互**: 顶部工具栏右侧“书签”图标。点击切换 实心/空心 状态。

### C. 护眼增强 (Eye Care Themes)
*   **现状**: 只有 黑/白 两色。
*   **优化**: 增加 **羊皮纸 (Sepia)** 和 **护眼绿 (Green)** 背景色。这比单纯的反色夜间模式更适合长时间阅读文书。

### D. 文本选择与复制 (Text Selection)
*   **价值**: 复制关键数据或段落。
*   **难点**: `AndroidPdfViewer` 是基于 Bitmap 渲染的，原生文本选择体验较差。
*   **替代**: 如果实现困难，可提供 "长按页面OCR" 或 "提取当前页纯文本" 的功能。

## 4. 实施路线图 (Roadmap)

建议按由于以下顺序开发：

1.  **Phase 2.1 (导航增强)**: 实现 **目录大纲** 和 **缩略图**。这是最基础的阅读保障。
2.  **Phase 2.2 (会议核心)**: 实现 **会议同屏 (WebSocket)**。这是本产品的核心竞争力。
3.  **Phase 2.3 (批注)**: 实现简单的画笔批注。
4.  **Phase 3 (高级)**: 搜索、书签、护眼模式。